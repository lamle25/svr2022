name: Windows Server 2022 Setup

on:
  workflow_dispatch:

jobs:
  setup:
    #runs-on: windows-2022
    runs-on: windows-11

    steps:
      - name: Install Remotely Agent
        shell: pwsh
        run: |
          Write-Host "üì¶ Downloading and installing Remotely agent..."
          $url = 'https://lamle.dpdns.org/api/ClientDownloads/WindowsInstaller/d5f2586b-3579-4c89-99ad-6e855fbc93f0'          
          $outfile = "$env:TEMP\Install-Remotely.ps1"
          Invoke-WebRequest -Uri $url -OutFile $outfile -UseBasicParsing
          Write-Host "‚ñ∂Ô∏è Running installer script..."
          Start-Process -FilePath "powershell.exe" -ArgumentList "-ExecutionPolicy Bypass -File `"$outfile`"" -Verb RunAs
          Write-Host "‚úÖ Remotely agent installation triggered."
          
      - name: Keep session alive
        shell: pwsh
        run: |
          Write-Host "üïì Keeping VM alive for RDP/Remotely..."
          while ($true) { Start-Sleep -Seconds 3600 }
